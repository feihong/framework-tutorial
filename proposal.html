

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Secrets of the Framework Creators &mdash; Secrets of the Framework Creators 0.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="_static/tutorial.css" type="text/css" />
  

  
    <link rel="top" title="Secrets of the Framework Creators 0.1 documentation" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Secrets of the Framework Creators
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="framehack/index.html">Frame Hacks</a></li>
<li class="toctree-l1"><a class="reference internal" href="decorator/index.html">Decorators</a></li>
<li class="toctree-l1"><a class="reference internal" href="metaclass/index.html">Metaclasses</a></li>
<li class="toctree-l1"><a class="reference internal" href="magicmethod/index.html">Magic Methods</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Secrets of the Framework Creators</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Secrets of the Framework Creators</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/proposal.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="secrets-of-the-framework-creators">
<h1>Secrets of the Framework Creators<a class="headerlink" href="#secrets-of-the-framework-creators" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Feihong Hsu</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:hsu&#46;feihong&#37;&#52;&#48;yahoo&#46;com">hsu<span>&#46;</span>feihong<span>&#64;</span>yahoo<span>&#46;</span>com</a> 847.219.6000</td>
</tr>
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">Kumar McMillan</td>
</tr>
<tr class="field-even field"><th class="field-name">Contact:</th><td class="field-body"><a class="reference external" href="mailto:kumar&#46;mcmillan&#37;&#52;&#48;gmail&#46;com">kumar<span>&#46;</span>mcmillan<span>&#64;</span>gmail<span>&#46;</span>com</a> 773.726.2397</td>
</tr>
</tbody>
</table>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#summary" id="id3">Summary</a></li>
<li><a class="reference internal" href="#prerequisites" id="id4">Prerequisites</a></li>
<li><a class="reference internal" href="#presenter-bio" id="id5">Presenter Bio</a><ul>
<li><a class="reference internal" href="#feihong-hsu" id="id6">Feihong Hsu</a></li>
<li><a class="reference internal" href="#kumar-mcmillan" id="id7">Kumar McMillan</a></li>
</ul>
</li>
<li><a class="reference internal" href="#presenter-experience" id="id8">Presenter Experience</a><ul>
<li><a class="reference internal" href="#id1" id="id9">Feihong Hsu</a></li>
<li><a class="reference internal" href="#id2" id="id10">Kumar McMillan</a></li>
</ul>
</li>
<li><a class="reference internal" href="#recipes" id="id11">Recipes</a><ul>
<li><a class="reference internal" href="#the-most-common-gotcha" id="id12">The most common gotcha</a></li>
<li><a class="reference internal" href="#frame-hack-1-ruby-style-string-interpolation" id="id13">Frame Hack #1: Ruby-style string interpolation</a></li>
<li><a class="reference internal" href="#frame-hack-1-5-ruby-style-string-interpolation-2" id="id14">Frame Hack #1.5: Ruby-style string interpolation 2</a></li>
<li><a class="reference internal" href="#frame-hack-2-generating-properties-in-a-wrapper-class" id="id15">Frame Hack #2: Generating properties in a wrapper class</a></li>
<li><a class="reference internal" href="#magic-method-hack-1-generating-hierarchical-data" id="id16">Magic Method Hack #1: Generating hierarchical data</a></li>
<li><a class="reference internal" href="#magic-method-hack-2-easy-gui-layout" id="id17">Magic Method Hack #2: Easy GUI layout</a></li>
<li><a class="reference internal" href="#metaclass-hack-1-painless-bitfield-properties" id="id18">Metaclass Hack #1: Painless bitfield properties</a></li>
<li><a class="reference internal" href="#metaclass-hack-2-decorate-all-methods-in-a-class" id="id19">Metaclass Hack #2: Decorate all methods in a class</a></li>
<li><a class="reference internal" href="#decorator-hack-1-easy-event-binding" id="id20">Decorator Hack #1: Easy event binding</a></li>
<li><a class="reference internal" href="#decorate-hack-2-custom-event-binding" id="id21">Decorate Hack #2: Custom event binding</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id3">Summary</a><a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>We Python programmers all have our favorite modules, such as Django, Elixir, Trellis, Breve, pyglet, etc. We use them because they save us time and allow us to write less code. We benefit from the day-to-day usage of these modules, but we can also benefit greatly from peeking under the hood and seeing how they do what they do. In many cases, these modules make liberal use of advanced Python features such as frames, metaclasses, magic methods, and decorators. In this tutorial we&#8217;ll show you how to use these features to create compelling libraries and frameworks.</p>
<p>In total we&#8217;ll go through 8 recipes, all culled from real-world code. As we go through the examples we&#8217;ll show case studies where the same or similar technique is used in a popular module. These case studies help participants to precisely understand what problem the recipe attempts to solve. There will be a high emphasis on live coding. The authors will develop each example from scratch, stopping frequently to run the code and show what the current version is doing. Each example will be accompanied by exercises that can be attempted by more advanced programmers as they wait for novice programmers to ask questions and get answers.</p>
</div>
<div class="section" id="prerequisites">
<h2><a class="toc-backref" href="#id4">Prerequisites</a><a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is targeted towards intermediate Python programmers. A lot of time will be given towards explaining and demonstrating concepts and syntax. However, the participant is supposed to know the following prior to attending this talk:</p>
<ul class="simple">
<li>How to use generators, list comprehensions, decorators, and the yield statement</li>
<li>String interpolation. Knowing the string.Template class is helpful but not required.</li>
<li>Regular expressions.</li>
<li>Basic understanding of GUI concepts. Some familiarity with Tkinter is helpful but not required.</li>
<li>A solid understanding of HTML and XML. It helps to know an XML processing library such as elementtree.</li>
<li>Object-oriented programming in Python (inheritance, constructors, properties, etc.).</li>
<li>How to use the bitwise operators <code class="docutils literal"><span class="pre">(&amp;,</span> <span class="pre">|,</span> <span class="pre">^)</span></code>.</li>
<li>Exception handling.</li>
<li>Basic understanding of threads.</li>
</ul>
<p>As for software, you won&#8217;t need anything more than an installation of Python 2.4 or Python 2.5.</p>
</div>
<div class="section" id="presenter-bio">
<h2><a class="toc-backref" href="#id5">Presenter Bio</a><a class="headerlink" href="#presenter-bio" title="Permalink to this headline">¶</a></h2>
<div class="section" id="feihong-hsu">
<h3><a class="toc-backref" href="#id6">Feihong Hsu</a><a class="headerlink" href="#feihong-hsu" title="Permalink to this headline">¶</a></h3>
<p>Feihong Hsu is a programmer working at Morningstar, Inc, in Chicago. He commutes daily from the wild and wolly exurbs of northwest Chicagoland. Although primarily a Python programmer, he has another, darker persona that dabbles in C#. The main crux of his job is to cajole, conflate, and massage vast quantities of financial data.</p>
</div>
<div class="section" id="kumar-mcmillan">
<h3><a class="toc-backref" href="#id7">Kumar McMillan</a><a class="headerlink" href="#kumar-mcmillan" title="Permalink to this headline">¶</a></h3>
<p>Kumar McMillan lives in sunny Chicago, IL and works as a Senior Software Engineer at Leapfrog Online, LLC.  He uses Python to manage Leapfrog&#8217;s ETL pipeline (Extracting, Transforming, and Loading data) as well as build web applications / services and automated testing strategies.  He is an active member of the open source community, maintaining several packages like fixture, wsgi_intercept, wikir, and helping out on nose, blogmaker and several others.  He writes about software from time to time on his blog, <a class="reference external" href="http://farmdev.com/">http://farmdev.com/</a></p>
</div>
</div>
<div class="section" id="presenter-experience">
<h2><a class="toc-backref" href="#id8">Presenter Experience</a><a class="headerlink" href="#presenter-experience" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id9">Feihong Hsu</a><a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Feihong spent two years as a Computer Science teaching assistant at the University of Illinois at Chicago. Unlike other TAs, he had two or more lab sessions a week that were primarily planned and executed by himself. For his efforts he was awarded an Outstanding TA Award in 2003. He also spent a summer teaching an introductory programming course in JavaScript (where he was the primary instructor). He spent a school year teaching English to Chinese middle school students. Earlier this year in March he gave a talk at ChiPy entitled &#8220;Unicode for Small Children (and Children at Heart)&#8221;. The slides for the talk can be found at <a class="reference external" href="http://feihonghsu.blogspot.com/2007/03/unicode-talk.html">http://feihonghsu.blogspot.com/2007/03/unicode-talk.html</a>.</p>
</div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id10">Kumar McMillan</a><a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>After working on music at The School of the Art Institute of Chicago, Kumar naturally segued into self-taught computer science.  He began building websites in a little language called PHP and soon moved on to Python.  He created a consulting business in 2001 where he worked with clients like Selective Search, Inc and IBM Global Services.  In 2004, he became the third member of Leapfrog Online&#8217;s technology department, working on web applications alongside Jason Pellerin and Michael Manley.  Together they built what is now a team of eight software engineers, two database administrators, and three quality assurance engineers.  Besides becoming enamored with the challenges and rewards of automated testing, Kumar has worked on several open source projects and given presentations such as &#8220;You vs. The Real World: Testing With Fixtures&#8221; (Pycon, 2007), &#8220;Python in TextMate Demo&#8221; (ChiPy, 2007), and &#8220;How To Get Started Writing OpenSocial Applications&#8221; (ChiPy, 2007).</p>
<div class="admonition-recording admonition">
<p class="first admonition-title">Recording:</p>
<p class="last">&#8220;I give permission to record and publish my PyCon presentation for free distribution.&#8221;</p>
</div>
</div>
</div>
<div class="section" id="recipes">
<h2><a class="toc-backref" href="#id11">Recipes</a><a class="headerlink" href="#recipes" title="Permalink to this headline">¶</a></h2>
<div class="section" id="the-most-common-gotcha">
<h3><a class="toc-backref" href="#id12">The most common gotcha</a><a class="headerlink" href="#the-most-common-gotcha" title="Permalink to this headline">¶</a></h3>
<p>Stop! Before you attempt any of the recipes we are showing you today, check to make sure you are using new-style classes. That means your classes need to derive from object. In a lot of cases, the Python interpreter will not complain if you do not inherit from object, instead you&#8217;ll just get really strange results.</p>
<p>Moral of the story:</p>
<p>Don&#8217;t attempt super awesome hacks using old-style classes.</p>
</div>
<div class="section" id="frame-hack-1-ruby-style-string-interpolation">
<h3><a class="toc-backref" href="#id13">Frame Hack #1: Ruby-style string interpolation</a><a class="headerlink" href="#frame-hack-1-ruby-style-string-interpolation" title="Permalink to this headline">¶</a></h3>
<p>This is a very basic application of frames. Lets you write code like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Feihong&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">place</span> <span class="o">=</span> <span class="s">&#39;Chicago&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">interpolate</span><span class="p">(</span><span class="s">&quot;My name is ${name}. I work in ${place}.&quot;</span><span class="p">)</span>
<span class="go">&quot;My name is Feihong. I work in Chicago.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="frame-hack-1-5-ruby-style-string-interpolation-2">
<h3><a class="toc-backref" href="#id14">Frame Hack #1.5: Ruby-style string interpolation 2</a><a class="headerlink" href="#frame-hack-1-5-ruby-style-string-interpolation-2" title="Permalink to this headline">¶</a></h3>
<p>It is easy to enhance the previous hack by allowing arbitrary Python expressions to be embedded in the template string. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Feihong&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">places</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s">&#39;Seattle&#39;</span><span class="p">,</span> <span class="s">&#39;New York&#39;</span><span class="p">,</span> <span class="s">&#39;LA&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">interpolate</span><span class="p">(</span><span class="s">&quot;My name is ${&#39;Mr. &#39; name}. &quot;</span> \
<span class="go">                      &quot;I have been to ${&#39;, &#39;.join(places[:-1] + &#39;, and &#39; + places[-1]}.&quot;)</span>
<span class="go">&quot;My name is Mr. Feihong. I have been to Chicago, Seattle, New York, and LA.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="frame-hack-2-generating-properties-in-a-wrapper-class">
<h3><a class="toc-backref" href="#id15">Frame Hack #2: Generating properties in a wrapper class</a><a class="headerlink" href="#frame-hack-2-generating-properties-in-a-wrapper-class" title="Permalink to this headline">¶</a></h3>
<p>Let&#8217;s say you have a C++ object that has a really annoying interface with a lot of getter and setter methods. You want to make a Pythonic wrapper that replaces those getters and setters with properties.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Pretend this was implemented in C++:</span>
<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">given_name</span><span class="p">,</span> <span class="n">family_name</span><span class="p">,</span> <span class="n">date_of_birth</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_name</span> <span class="o">=</span> <span class="n">given_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">family_name</span> <span class="o">=</span> <span class="n">family_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">=</span> <span class="n">date_of_birth</span>

    <span class="k">def</span> <span class="nf">GetGivenName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_name</span>
    <span class="k">def</span> <span class="nf">SetGivenName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="bp">self</span><span class="o">.</span><span class="n">given_name</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">GetFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">family_name</span>
    <span class="k">def</span> <span class="nf">SetFamilyName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="bp">self</span><span class="o">.</span><span class="n">family_name</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">GetDateOfBirth</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_of_birth</span>
    <span class="k">def</span> <span class="nf">SetDateOfBirth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>  <span class="bp">self</span><span class="o">.</span><span class="n">date_of_birth</span> <span class="o">=</span> <span class="n">value</span>
    <span class="c"># ad infinitum...</span>

<span class="c"># Let&#39;s make the property names shorter because we&#39;re lazy and don&#39;t like typing too much:</span>
<span class="k">class</span> <span class="nc">PyEmployee</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">properties</span><span class="p">(</span>
        <span class="p">(</span><span class="s">&#39;given&#39;</span><span class="p">,</span> <span class="s">&#39;GivenName&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;family&#39;</span><span class="p">,</span> <span class="s">&#39;FamilyName&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s">&#39;birth&#39;</span><span class="p">,</span> <span class="s">&#39;DateOfBirth&#39;</span><span class="p">),</span>
    <span class="p">)</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">PyEmployee</span><span class="p">(</span><span class="n">given</span><span class="o">=</span><span class="s">&#39;Feihong&#39;</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s">&#39;Hsu&#39;</span><span class="p">,</span> <span class="n">birth</span><span class="o">=</span><span class="s">&#39;2007-11-19&#39;</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">given</span> <span class="o">=</span> <span class="s">&#39;Horatio&#39;</span>
<span class="k">print</span> <span class="n">e</span><span class="o">.</span><span class="n">given</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">given_name</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">GetGivenName</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">Would it be useful or confusing to make them leave out the object as the superclass of Employee? I was thinking it might be instructive, as having the code fail unexpectedly might help people remember to always inherit from object when dealing with properties.</p>
</div>
</div>
<div class="section" id="magic-method-hack-1-generating-hierarchical-data">
<h3><a class="toc-backref" href="#id16">Magic Method Hack #1: Generating hierarchical data</a><a class="headerlink" href="#magic-method-hack-1-generating-hierarchical-data" title="Permalink to this headline">¶</a></h3>
<p>This is something that first appeared in stan, and now is seen in Breve. It allows you to use s-expressions to generate hierarchical data.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">dijit</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s">&quot;dijitopen.txt&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span> <span class="s">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">)</span>
<span class="n">div</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;div&quot;</span><span class="p">)</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;label&quot;</span><span class="p">)</span>
<span class="n">checkbox</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)(</span><span class="n">dojoType</span><span class="o">=</span><span class="s">&quot;dijit.form.CheckBox&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;checkbox&quot;</span><span class="p">,</span>
                        <span class="n">checked</span><span class="o">=</span><span class="s">&quot;checked&quot;</span><span class="p">)</span>
<span class="n">textbox</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)(</span><span class="n">dojoType</span><span class="o">=</span><span class="s">&quot;dijit.form.TextBox&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">)</span>
<span class="n">button</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;button&quot;</span><span class="p">)(</span><span class="n">dojoType</span><span class="o">=</span><span class="s">&quot;dijit.form.Button&quot;</span><span class="p">)</span>
<span class="n">datetextbox</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="s">&quot;input&quot;</span><span class="p">)(</span><span class="n">dojoType</span><span class="o">=</span><span class="s">&quot;dijit.form.DateTextBox&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;text&quot;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="n">dijit</span> <span class="p">[</span>
    <span class="n">textbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;My hobby is collecting stamps&quot;</span><span class="p">),</span>
    <span class="n">button</span><span class="p">[</span><span class="s">&quot;Buy a stamp&quot;</span><span class="p">],</span>
    <span class="n">div</span> <span class="p">[</span>
        <span class="n">checkbox</span><span class="p">,</span>
        <span class="n">label</span><span class="p">[</span><span class="s">&quot;Are you insane?&quot;</span><span class="p">],</span>
        <span class="n">datetextbox</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="s">&quot;2007-11-19&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">div</span> <span class="p">[</span>
        <span class="n">button</span><span class="p">[</span><span class="s">&quot;Pause&quot;</span><span class="p">],</span>
        <span class="n">button</span><span class="p">[</span><span class="s">&quot;Play&quot;</span><span class="p">],</span>
        <span class="n">button</span><span class="p">[</span><span class="s">&quot;Stop&quot;</span><span class="p">],</span>
    <span class="p">],</span>
<span class="p">]</span><span class="o">.</span><span class="n">tostring</span><span class="p">()</span>

<span class="nb">open</span><span class="p">(</span><span class="s">&#39;output.html&#39;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">This example is supposed to generate the HTML to render a Dijit interface (this works out well for demo purposes because the example could work without actually having to download Dojo itself, you could just reference the Amazon cached version). The code for this example turned out to be bit longer than I expected. In it you have to implement both __getitem__ and __call__. Although the example is more complicated than what you get with Breve, it illustrates that you can use this technique to generate arbitrary XML/HTML output. Extending it even further, you could use it to quickly define a transformation processor for any kind of semistructured input.</p>
</div>
</div>
<div class="section" id="magic-method-hack-2-easy-gui-layout">
<h3><a class="toc-backref" href="#id17">Magic Method Hack #2: Easy GUI layout</a><a class="headerlink" href="#magic-method-hack-2-easy-gui-layout" title="Permalink to this headline">¶</a></h3>
<p>Similar to the previous example, but this time we&#8217;re creating objects, not generating text. This hack also uses the sort of frame hack that is heavily used in libraries such as Elixir and Trellis.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Button</span><span class="p">(</span><span class="n">TkWrapper</span><span class="p">):</span>
    <span class="n">wraps</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Button</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Label</span><span class="p">(</span><span class="n">TkWrapper</span><span class="p">):</span>
    <span class="n">wraps</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Label</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">HBox</span><span class="p">(</span><span class="n">TkWrapper</span><span class="p">):</span>
    <span class="n">wraps</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">,</span> <span class="n">is_container</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&quot;horizontal&quot;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">VBox</span><span class="p">(</span><span class="n">TkWrapper</span><span class="p">):</span>
    <span class="n">wraps</span><span class="p">(</span><span class="n">tk</span><span class="o">.</span><span class="n">Frame</span><span class="p">,</span> <span class="n">is_container</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&quot;vertical&quot;</span><span class="p">)</span>

<span class="n">frame</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">()</span> <span class="p">[</span>
    <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;One&#39;</span><span class="p">),</span>
    <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Two&#39;</span><span class="p">),</span>
    <span class="n">Button</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Tree&#39;</span><span class="p">),</span>
    <span class="n">VBox</span><span class="p">()</span> <span class="p">[</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Apple&#39;</span><span class="p">),</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Banana&#39;</span><span class="p">),</span>
        <span class="n">Label</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s">&#39;Cranberry&#39;</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">]</span>
<span class="n">frame</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">This example really involves a lot more than just __getitem__ magic method. It also uses a relatively simple frame hack. To convert the example to more usable code you&#8217;d have to implement the __getattr__ (for underlying Tkinter method access) and __call__ (so we can use the nicer tag-based API of the previous example) magic methods as well. I have some serious doubts about being able to cover all that in the given time, though.</p>
</div>
</div>
<div class="section" id="metaclass-hack-1-painless-bitfield-properties">
<h3><a class="toc-backref" href="#id18">Metaclass Hack #1: Painless bitfield properties</a><a class="headerlink" href="#metaclass-hack-1-painless-bitfield-properties" title="Permalink to this headline">¶</a></h3>
<p>In this example, style is a bitfield attribute. We want to have a property for each possible bit of the style attribute.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ENABLED</span><span class="p">,</span> <span class="n">SIMPLE</span><span class="p">,</span> <span class="n">SUNKEN</span><span class="p">,</span> <span class="n">RAISED</span><span class="p">,</span> <span class="n">TRANSPARENT</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span>

<span class="k">class</span> <span class="nc">Widget</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">__bitproperties__</span>

    <span class="n">style</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">enabled</span> <span class="o">=</span> <span class="n">bit_property</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="n">ENABLED</span><span class="p">)</span>
    <span class="n">simple</span> <span class="o">=</span> <span class="n">bit_property</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="n">SIMPLE</span><span class="p">)</span>
    <span class="n">sunken</span> <span class="o">=</span> <span class="n">bit_property</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="n">SUNKEN</span><span class="p">)</span>
    <span class="n">raised</span> <span class="o">=</span> <span class="n">bit_property</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="n">RAISED</span><span class="p">)</span>
    <span class="n">transparent</span> <span class="o">=</span> <span class="n">bit_property</span><span class="p">(</span><span class="s">&quot;style&quot;</span><span class="p">,</span> <span class="n">TRANSPARENT</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&#39;-&#39;</span><span class="o">*</span><span class="mi">80</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">Widget</span><span class="p">()</span>
<span class="n">w</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">print</span> <span class="n">w</span><span class="o">.</span><span class="n">style</span>               <span class="c"># 1</span>

<span class="n">w</span><span class="o">.</span><span class="n">sunken</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">print</span> <span class="n">w</span><span class="o">.</span><span class="n">style</span>               <span class="c"># 5</span>

<span class="n">w</span><span class="o">.</span><span class="n">transparent</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">print</span> <span class="n">w</span><span class="o">.</span><span class="n">style</span>               <span class="c"># 21</span>

<span class="n">w</span><span class="o">.</span><span class="n">sunken</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">print</span> <span class="n">w</span><span class="o">.</span><span class="n">style</span>               <span class="c"># 17</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">The code here turned out longer and more complex than I expected. The reason may be that I don&#8217;t understand how to work around Python&#8217;s closure deficiencies well enough. I was forced to generate the code for the getter and setter as strings and then eval them. So it&#8217;s a bit on the ugly side.</p>
</div>
</div>
<div class="section" id="metaclass-hack-2-decorate-all-methods-in-a-class">
<h3><a class="toc-backref" href="#id19">Metaclass Hack #2: Decorate all methods in a class</a><a class="headerlink" href="#metaclass-hack-2-decorate-all-methods-in-a-class" title="Permalink to this headline">¶</a></h3>
<p>Both method1() and method2() print a stack trace when an error occurs, and go straight into the debugger; they do not terminate the program.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>

<span class="k">class</span> <span class="nc">Example</span><span class="p">:</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">__debug__</span> <span class="k">if</span> <span class="n">DEBUG</span> <span class="k">else</span> <span class="nb">type</span>

    <span class="k">def</span> <span class="nf">method1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
       <span class="n">result</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">/</span> <span class="n">v</span>     <span class="c"># exception if v == 0</span>
       <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">method2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
       <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s"> is </span><span class="si">%s</span><span class="s">!&quot;</span> <span class="o">%</span> <span class="n">args</span>  <span class="c"># exception if len(args) != 2</span>
       <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">The way the methods will be decorated is we&#8217;ll wrap the original function call inside a try block and use traceback.print_exc(file=sys.stdout) inside the except block. Then we just call pdb.set_trace() to enter the debugger.</p>
</div>
</div>
<div class="section" id="decorator-hack-1-easy-event-binding">
<h3><a class="toc-backref" href="#id20">Decorator Hack #1: Easy event binding</a><a class="headerlink" href="#decorator-hack-1-easy-event-binding" title="Permalink to this headline">¶</a></h3>
<p>This style of decorator-based event binding can be found in pyglet.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">frame</span> <span class="o">=</span> <span class="n">Frame</span><span class="p">()</span>
<span class="n">frame</span><span class="o">.</span><span class="n">master</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s">&quot;Event binding with decorators&quot;</span><span class="p">)</span>
<span class="n">frame</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

<span class="n">btn</span> <span class="o">=</span> <span class="n">Button</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s">&quot;Click me!&quot;</span><span class="p">)</span>
<span class="n">btn</span><span class="o">.</span><span class="n">pack</span><span class="p">()</span>

<span class="nd">@bind</span><span class="p">(</span><span class="n">btn</span><span class="p">,</span> <span class="s">&#39;&lt;Button-1&gt;&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">onclick</span><span class="p">(</span><span class="n">evt</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&#39;You clicked on the button &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">evt</span><span class="o">.</span><span class="n">widget</span><span class="p">[</span><span class="s">&#39;text&#39;</span><span class="p">]</span>

<span class="n">frame</span><span class="o">.</span><span class="n">mainloop</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">I got this idea from pyglet but it&#8217;s somewhat different from pyglet because pyglet uses simple decorators that don&#8217;t accept parameters. There is a variant of this where you allow the event callback to have different numbers of parameters by using function.func_code.co_argcount, but maybe that&#8217;s making this example more complicated than it needs to be.</p>
</div>
</div>
<div class="section" id="decorate-hack-2-custom-event-binding">
<h3><a class="toc-backref" href="#id21">Decorate Hack #2: Custom event binding</a><a class="headerlink" href="#decorate-hack-2-custom-event-binding" title="Permalink to this headline">¶</a></h3>
<p>Start the download off in another thread, then invoke the callback function when all files have been downloaded.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">downloader</span> <span class="o">=</span> <span class="n">Downloader</span><span class="p">(</span><span class="n">url_list</span><span class="p">)</span>

<span class="nd">@downloader.done</span>
<span class="k">def</span> <span class="nf">ondone</span><span class="p">(</span><span class="n">num_downloaded</span><span class="p">,</span> <span class="n">time_elapsed</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">&quot;Fetched&quot;</span><span class="p">,</span> <span class="n">num_downloaded</span><span class="p">,</span> <span class="s">&quot;files in&quot;</span><span class="p">,</span> <span class="n">time_elapsed</span><span class="p">,</span> <span class="s">&quot;seconds&quot;</span>

<span class="n">downloader</span><span class="o">.</span><span class="n">start_downloads</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition-notes admonition">
<p class="first admonition-title">Notes:</p>
<p class="last">This example shows how to use an object as a decorator. The actual decoration code is inside the __call__() magic method of the object. There are a few reasons why we might want to make the decorator an object instead of a function. Chief among them would be if we wanted to support different styles of event binding, for example downloader.done.register(callback) or downloader.done.deregister().</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/tutorial.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>